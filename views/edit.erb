<h1>Editing <a href="/<%= @page.name %>"><%= @page.title %></a></h1>

<div class="sub_nav">
  <a href="/<%= @page.basename %>" class="nav_link">back</a>
  &bull; <a href="/a/file/upload/<%= @page.basename %>" class="nav_link">attach</a>

  <% if @page.tracked? %>
    &bull; <a href="/h/<%= @page.basename %>" class="nav_link">history</a>
  <% end %>

  <% if files = @page.attachments %>
    <h3>Attachments</h3>
    <% files.each do |file| %>
      <li><a href="<%= file.link_path %>"><%= file.name %></a>
        <span class="detail">(<%= file.size %>)</span>
        <div class="attach-options">
          <a href="<%= file.delete_path %>">delete</a>
          &bull; <a href="<%= file.link_path %>">download</a>
          &bull; <a href="#" onClick="insert_link('<%= file.name.unwiki_filename %>', '<%= file.link_path %>', <%= (file.image?) ? true : false %> )"; return false">insert &#187;</a>
        </div>
      </span>
    <% end %>
  <% end %>
</div>

<div class="content">
  <form method="post" action="/e/<%= @page.basename %>">
    <textarea name="body" id="edit_textarea"><%= @page.raw_body %></textarea>
    Message:
    <textarea name="message" rows="4" id="message_textarea"></textarea>
    <p class="right"><input type="submit" value="Save" class="submit" /></p>
  </form>
</div>

<script type="text/javascript">
  function insert_link(name, url, image){
    if(image){
      $("#edit_textarea").html($("#edit_textarea").html() + "\n!["+name+"]("+url+")");
    }else{
      $("#edit_textarea").html($("#edit_textarea").html() + "\n["+name+"]("+url+")");
    }
  }
</script>